{"version":3,"sources":["webpack:///./src/views/Home.vue?f814","webpack:///./src/views/Home.vue?dabe","webpack:///./src/utils/util.ts","webpack:///./src/views/Home.vue","webpack:///./src/views/Home.vue?2d60","webpack:///./src/views/Home.vue?c853","webpack:///./src/views/Home.vue?ece4"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","class","$style","container","home","_v","directives","name","rawName","value","isGranted","expression","notif","keys","key","_m","code","_s","vapidPublicKey","vapidPrivateKey","auth","authTitle","authCode","subJSON","staticRenderFns","base64UrlToUint8Array","base64UrlData","padding","repeat","length","base64","replace","rawData","window","atob","buffer","Uint8Array","i","charCodeAt","uint8ArrayToBase64Url","uint8Array","start","end","byteLength","btoa","String","fromCharCode","apply","Array","from","subarray","cryptoKeyToUrlBase64","publicKey","privateKey","promises","push","crypto","subtle","exportKey","then","jwk","x","y","set","d","Promise","all","exportedKeys","generateNewKeys","generateKey","namedCurve","status","localStorage","getItem","newKeys","Notification","requestPermission","showKeys","subscribeNotif","setItem","navigator","serviceWorker","ready","registration","pushManager","getSubscription","subscription","subscribe","userVisibleOnly","applicationServerKey","toJSON","immediate","injectStyles","context","locals","component"],"mappings":"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","file":"js/home.6c760555.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Home_container_31xJP\",\"home\":\"Home_home_16VbE\",\"notif\":\"Home_notif_2JaVC\",\"keys\":\"Home_keys_3g8yn\",\"key\":\"Home_key_w3LkO\",\"code\":\"Home_code_19HD-\",\"auth\":\"Home_auth_3TG_i\",\"authCode\":\"Home_authCode_10X4c\"};","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{class:_vm.$style.container},[_c('div',{class:_vm.$style.home},[_c('h1',[_vm._v(\"Service Worker Push Notifications Demo\")]),_c('p',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isGranted),expression:\"!isGranted\"}],class:_vm.$style.notif},[_vm._v(\" Please allow show notifications. \")]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showKeys),expression:\"showKeys\"}],class:_vm.$style.keys},[_c('div',{class:_vm.$style.key},[_vm._m(0),_c('p',{class:_vm.$style.code},[_vm._v(\" \"+_vm._s(_vm.vapidPublicKey)+\" \")])]),_c('div',{class:_vm.$style.key},[_vm._m(1),_c('p',{class:_vm.$style.code},[_vm._v(\" \"+_vm._s(_vm.vapidPrivateKey)+\" \")])])]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.subJSON),expression:\"subJSON\"}],class:_vm.$style.auth},[_c('p',{class:_vm.$style.authTitle},[_c('strong',[_vm._v(\" PushSubscriptionJSON Info\")])]),_c('p',{class:_vm.$style.authCode},[_vm._v(\" \"+_vm._s(_vm.subJSON)+\" \")])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"Public Key\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"Private Key\")])])}]\n\nexport { render, staticRenderFns }","interface KeyPair {\n  publicKey: string;\n  privateKey: string;\n}\n\nfunction base64UrlToUint8Array(base64UrlData: string): Uint8Array {\n  const padding = '='.repeat((4 - (base64UrlData.length % 4)) % 4);\n  const base64 = (base64UrlData + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const buffer = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    buffer[i] = rawData.charCodeAt(i);\n  }\n  return buffer;\n}\n\nfunction uint8ArrayToBase64Url(\n  uint8Array: Uint8Array,\n  start?: number,\n  end?: number\n): string {\n  start = start || 0;\n  end = end || uint8Array.byteLength;\n\n  const base64 = window.btoa(\n    String.fromCharCode.apply(null, Array.from(uint8Array.subarray(start, end)))\n  );\n  return base64.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nfunction cryptoKeyToUrlBase64(publicKey: CryptoKey, privateKey: CryptoKey) {\n  const promises = [];\n  promises.push(\n    crypto.subtle.exportKey('jwk', publicKey).then(jwk => {\n      const x = base64UrlToUint8Array(jwk.x!);\n      const y = base64UrlToUint8Array(jwk.y!);\n\n      const publicKey = new Uint8Array(65);\n      publicKey.set([0x04], 0);\n      publicKey.set(x, 1);\n      publicKey.set(y, 33);\n\n      return publicKey;\n    })\n  );\n\n  promises.push(\n    crypto.subtle.exportKey('jwk', privateKey).then(jwk => {\n      return base64UrlToUint8Array(jwk.d!);\n    })\n  );\n\n  return Promise.all(promises).then(exportedKeys => {\n    return {\n      publicKey: uint8ArrayToBase64Url(exportedKeys[0]),\n      privateKey: uint8ArrayToBase64Url(exportedKeys[1])\n    };\n  });\n}\n\nfunction generateNewKeys(): Promise<KeyPair> {\n  return crypto.subtle\n    .generateKey({ name: 'ECDH', namedCurve: 'P-256' }, true, ['deriveBits'])\n    .then(keys => {\n      return cryptoKeyToUrlBase64(keys.publicKey, keys.privateKey);\n    });\n}\n\nexport { base64UrlToUint8Array, uint8ArrayToBase64Url, generateNewKeys };\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue, Watch } from 'vue-property-decorator';\nimport { generateNewKeys } from '@/utils/util';\n\ninterface PushSubscriptionJSON {\n  endpoint?: string;\n  expirationTime?: number | null;\n  keys?: Record<string, string>;\n}\n\n@Component\nexport default class Home extends Vue {\n  status = '';\n  vapidPublicKey = localStorage.getItem('vapidPublicKey') || '';\n  vapidPrivateKey = localStorage.getItem('vapidPrivateKey') || '';\n  subJSON: PushSubscriptionJSON | null = null;\n\n  @Watch('isGranted', { immediate: true })\n  onPermissionChanged(): void {\n    if (this.isGranted) {\n      this.newKeys();\n    }\n  }\n\n  get isGranted(): boolean {\n    return this.status === 'granted';\n  }\n\n  get showKeys(): boolean {\n    return this.vapidPublicKey.length > 0;\n  }\n\n  created(): void {\n    Notification.requestPermission(status => {\n      this.status = status;\n    });\n  }\n\n  newKeys(): void {\n    if (this.showKeys) {\n      this.subscribeNotif();\n    } else {\n      generateNewKeys()\n        .then(keys => {\n          const { publicKey, privateKey } = keys;\n          localStorage.setItem('vapidPublicKey', publicKey);\n          localStorage.setItem('vapidPrivateKey', privateKey);\n          this.vapidPublicKey = publicKey;\n          this.vapidPrivateKey = privateKey;\n        })\n        .then(() => {\n          this.subscribeNotif();\n        });\n    }\n  }\n\n  subscribeNotif(): void {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        return registration.pushManager.getSubscription().then(subscription => {\n          if (subscription === null) {\n            return registration.pushManager.subscribe({\n              userVisibleOnly: true,\n              applicationServerKey: this.vapidPublicKey\n            });\n          } else {\n            return subscription;\n          }\n        });\n      })\n      .then(subscription => {\n        this.subJSON = subscription.toJSON();\n      });\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=b0722a14&\"\nimport script from \"./Home.vue?vue&type=script&lang=ts&\"\nexport * from \"./Home.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&lang=postcss&module=true&\"\n\n\n\n\nfunction injectStyles (context) {\n  \n  this[\"$style\"] = (style0.locals || style0)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  null\n  \n)\n\nexport default component.exports","export { default } from  \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-0-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-0-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-0-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&lang=postcss&module=true&\"; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-0-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-0-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-0-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&lang=postcss&module=true&\""],"sourceRoot":""}